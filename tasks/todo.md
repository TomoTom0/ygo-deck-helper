# TODO

未着手のタスク（優先度順）

## 📊 現状サマリー

**検索パラメータマッピング**: ⚠️ **不完全、再調査が必要**

詳細は `tasks/wip.md` を参照。

---

## 🚨 緊急タスク（最優先）

### 検索フォームの正しい分析

#### 背景
過去の分析（tmp/search-form-analysis.json）が不完全：
- value属性は取得したが、ラベルテキストが全て `"label": null`
- species（種族）マッピングがほぼ全て間違っていた

#### タスク
- [x] 検索フォームHTMLを取得
- [x] 全パラメータについてvalue属性とラベルテキストの対応を正しく抽出（全パラメータ完了）
  - [x] species（種族） - 26件抽出、マッピング修正完了
  - [x] attr（属性） - 7件抽出、正しいことを確認
  - [x] other（モンスタータイプ） - 15件抽出、正しいことを確認
  - [x] effe（魔法・罠効果タイプ） - 7件抽出、正しいことを確認
  - [x] linkbtn（リンクマーカー） - 8件、実装が正しいことを確認
  - [x] level（レベル/ランク） - 14件、実装が正しいことを確認
  - [x] Pscale（ペンデュラムスケール） - 14件、実装が正しいことを確認
- [x] 現在の実装（extension/src/api/card-search.ts）と照合
- [x] 間違いがあれば修正（illusion: '26' → '34'）
- [ ] APIテストで最終検証（任意、実装は全て正しいことを確認済み）

---

## 🔍 次のステップ（優先度: 高）

### カード情報スクレイピングの検証と完成

#### 動作確認
- [ ] 未知の値の収集
  - console.warnで出力された未知の種族・タイプ・効果種類
  - マップ定義への追加が必要なもの

#### マップ定義の補完
- [ ] 未知の種族・タイプがあれば追加
- [ ] 英語名の確認（識別子として適切か）

---

## 🚀 実装フェーズ（Phase 2以降）

### Phase 2: セッション管理とデッキ操作の完全実装
- [ ] セッション管理の実装
  - `api/session.ts` - cgid/ytkn取得
- [ ] デッキ操作の完全実装
  - デッキ一覧取得
  - デッキ個別取得
  - デッキ新規作成
  - デッキ複製
  - デッキ削除
  - デッキ保存（カード情報の完全版を使用）

### Phase 3: UI実装
- [ ] Popup UIの実装
  - デッキ一覧表示
  - デッキ詳細表示
  - カード検索UI
  - デッキ編集UI
- [ ] Content Script UIの実装
  - ページ内へのUI注入
  - 既存UIの拡張

### Phase 4: テストとデプロイ
- [ ] ユニットテストの実装
  - パーサー関数のテスト
  - カードタイプ判定のテスト
  - マップ変換のテスト
- [ ] E2Eテストの実装
  - 既存の調査スクリプトをテストに変換
- [ ] デプロイ準備
  - manifest.jsonの最終調整
  - README.mdの作成

---

## 🔍 調査フェーズの残タスク（優先度: 低）

### カード詳細ページの完全調査
- [ ] カード詳細ページのURL形式の確認
  - cidからのURL生成方法
  - 複数バージョン（再録）がある場合の対応
- [ ] カード詳細情報の完全な構造確認
  - 効果テキストの取得
  - 裁定情報の取得
  - 関連カードの取得

### 他言語対応
- [ ] 他言語での動作確認
  - 英語（en）、韓国語（ko）、中国語（zh-CN）
  - 各言語でのi18nデータ作成
  - DOM属性ベース判定の言語非依存性確認

### エラーハンドリングと制限
- [ ] エラーハンドリングの詳細調査
  - バリデーションエラーのメッセージ形式
  - デッキ保存失敗時のエラー内容
- [ ] レート制限の有無確認
  - API呼び出し頻度制限
  - 一時的なアクセス制限

### 追加機能
- [ ] 公開デッキ機能の調査
  - 公開設定の変更方法
  - 公開デッキの検索方法
- [ ] カード画像hashの正確な生成ルール
  - 現在は `{cid}_1_1_1` で動作
  - 複数イラストがある場合の番号付け

---

## 📝 設計ドキュメント（完成済み）

以下のドキュメントを参照して実装を進めること：

- ✅ `docs/design/implementation-design.md` - 完全な実装設計
- ✅ `docs/design/implementation-guide.md` - 実装ガイド
- ✅ `docs/research/api-investigation-results.md` - API仕様詳細
- ✅ `docs/research/INVESTIGATION_SUMMARY.md` - 調査成果サマリー
- ✅ `tmp/wip/intro-implementation-status.md` - intro.md機能実装状況
- ✅ `tmp/wip/card-scraping-proposal-v3.md` - カード情報スクレイピング設計

---

**次のアクション**: 検索フォームを正しく分析し、全パラメータのvalue→label対応を取得する。
